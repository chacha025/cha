<!DOCTYPE html>
<html lang="ja">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>PSDレイヤーの抽出</title>
    <link rel="stylesheet" href="https://pyscript.net/latest/pyscript.css" />
    <script defer src="https://pyscript.net/latest/pyscript.js"></script>
  </head>

  <body>
    <h1>PSDから特定のレイヤーを表示</h1>
    <img id="layer-image" alt="PSD Layer Image" />

    <py-script>
      from psd_tools import PSDImage
      from PIL import Image
      import io
      from js import document, console
      import base64

      try:
          # PSDファイルのパス
          psd_path = 'a.psd'

          # 抽出するレイヤーの名前
          target_layer_name = 'ベタ塗り1'

          # PSDファイルを開く
          psd = PSDImage.open(psd_path)

          # 指定したレイヤーを探して表示
          for layer in psd.descendants():
              if layer.name == target_layer_name:
                  pil_img = layer.topil()
                  
                  # PIL画像をバイナリデータに変換
                  img_byte_arr = io.BytesIO()
                  pil_img.save(img_byte_arr, format='PNG')
                  img_byte_arr = img_byte_arr.getvalue()
                  
                  # 画像データをbase64エンコード
                  img_base64 = base64.b64encode(img_byte_arr).decode('utf-8')
                  
                  # HTML内のimgタグに画像を表示
                  img_element = document.getElementById('layer-image')
                  img_element.src = f"data:image/png;base64,{img_base64}"
                  break
          else:
              console.log(f"Layer '{target_layer_name}' not found.")
      except Exception as e:
          console.log(f"An error occurred: {e}")
    </py-script>
  </body>
</html>
